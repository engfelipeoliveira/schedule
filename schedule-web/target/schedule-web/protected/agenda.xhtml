<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:f="http://java.sun.com/jsf/core"
   xmlns:h="http://java.sun.com/jsf/html"
   xmlns:p="http://primefaces.org/ui"
   template="/WEB-INF/templates/default.xhtml">
   
   <ui:define name="content">
   
      <h1>Cadastrar Agenda</h1>
      
      <h:form id="agenda_frm">
      
      	<p:focus for="nome" id="focus" />
      	<p:growl id="growl" life="3000" />
      	<h:inputHidden id="id" value="#{agenda.id}" />
         <h:panelGrid columns="2" columnClasses="titleCell" id="agenda_pnl">
            <h:outputLabel for="nome" value="Nome*:"/>
            <p:inputText placeholder="Informe o nome completo" size="30" id="nome" value="#{agenda.destinatario.nome}" maxlength="100" required="true" requiredMessage="Nome é obrigatório" />

            <h:outputLabel for="telefone" value="Telefone:"/>
            <p:inputMask mask="(99)9999-9999" placeholder="Somente números (ddd + telefone)" size="30" id="telefone" converter="telefoneConverter" value="#{agenda.destinatario.telefone}"/>

            <h:outputLabel for="celular" value="Celular*:"/>
            <p:inputMask mask="(99)9.9999-9999" placeholder="Somente números (ddd + celular)" size="30" converter="telefoneConverter" id="celular" value="#{agenda.destinatario.celular}" required="true" requiredMessage="Celular é obrigatório"/>

            <h:outputLabel for="email" value="E-mail:"/>
            <p:inputText id="email" placeholder="Informe o e-mail" value="#{agenda.destinatario.email}" size="30" maxlength="100"/>
       
       		<h:outputLabel for="dataEvento" value="Data/Hora*:"/>
       		<p:calendar id="dataEvento" placeholder="Selecione a data/hora no calendário" size="30" readonlyInput="true" pattern="dd/MM/yyyy HH:mm" value="#{agenda.dataEvento}" required="true" requiredMessage="Data é obrigatória" locale="pt" timeZone="America/Sao_Paulo" navigator="true" />
         </h:panelGrid>
         
         <p>
            <h:panelGrid columns="3" >
               <p:commandButton ajax="false" id="incluir" update="growl :agenda_grid_frm" actionListener="#{agendaController.inserirAgenda()}" value="Salvar" icon="ui-icon-disk" />
               
               <p:commandButton value="Cancelar" id="cancelar" update="agenda_pnl id" process="@this" icon="ui-icon-cancel" >
                <p:resetInput target="agenda_pnl id" />
            </p:commandButton>
            
            <h:outputText value="(*) Dados Obrigatórios" />
               
            </h:panelGrid>
         </p>
         
      </h:form>
      
      <p>
      <h:form id="agenda_grid_frm">
         <p:dataTable id="dt_agenda" var="agendas" emptyMessage="Nenhum registro" value="#{agendaController.listarAgenda()}"
         paginator="true" rows="10" paginatorPosition="top" draggableColumns="true" resizableColumns="true"
         paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}" >
	       <f:facet name="{Exporters}">
	       <h:commandLink>
                Excel
                <p:dataExporter type="xls" target="dt_agenda" fileName="agendas" />
            </h:commandLink>
            |
	       <h:commandLink>
                PDF
                <p:dataExporter type="pdf" target="dt_agenda" fileName="agendas" />
            </h:commandLink>
            </f:facet>
	       
	       <p:column headerText="Nome" width="44%" >
	       	<h:outputText value="#{agendas.destinatario.nome}" />
	       </p:column>
	       <p:column headerText="Celular" width="20%" >
	          <h:outputText value="(#{agendas.destinatario.celular.toString().substring(0,2)})#{agendas.destinatario.celular.toString().substring(2,3)}.#{agendas.destinatario.celular.toString().substring(3,7)}-#{agendas.destinatario.celular.toString().substring(7,11)}" />
	       </p:column>
	       <p:column headerText="Data/Hora" width="25%">
	          <h:outputText value="#{agendaController.formataData(agendas.dataEvento, 'dd/MM/yyyy HH:mm')}" /> 
	       </p:column>
	       
	       <p:column  width="11%" exportable="false" >
	       	<center>
	           <p:commandButton ajax="true" id="excluir" actionListener="#{agendaController.excluirAgenda(agendas)}" title="Excluir" icon="ui-icon-trash" update=":agenda_frm:growl dt_agenda :agenda_frm:agenda_pnl">
	           	<p:confirm header="Excluir" message="Confirma a exclusão?" icon="ui-icon-alert" />
	           </p:commandButton>
	           <p:commandButton ajax="false" id="editar" actionListener="#{agendaController.selecionarAgenda(agendas)}" title="Editar" icon="ui-icon-pencil" update=":agenda_frm:growl dt_agenda" />
			</center>
	       </p:column>
	       
	   </p:dataTable>
	   
	   
	   <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
       </p:confirmDialog>
	   
      </h:form>
      </p>
   </ui:define>
</ui:composition>
